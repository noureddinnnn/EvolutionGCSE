:root {
  --ink: #102d42;
  --muted: #2f5168;
  --focus: #ffd166;
  --card: rgba(255,255,255,0.78);
}
* { box-sizing: border-box; }
body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  color: var(--ink);
  min-height: 100vh;
  padding: 1rem;
  background: linear-gradient(120deg, #d9ecff, #dff7f0, #eef0ff);
  background-size: 220% 220%;
  animation: bgShift 18s ease infinite;
}
@keyframes bgShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}
#bgCanvas {
  position: fixed;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: -2;
  opacity: 0.35;
}
.icon-layer {
  position: fixed;
  inset: 0;
  z-index: -1;
  pointer-events: none;
}
.icon-layer span {
  position: absolute;
  font-size: clamp(2rem, 5vw, 4rem);
  opacity: 0.08;
}
.icon-layer span:nth-child(1) { left: 8%; top: 12%; }
.icon-layer span:nth-child(2) { right: 14%; top: 20%; }
.icon-layer span:nth-child(3) { left: 15%; bottom: 18%; }
.icon-layer span:nth-child(4) { right: 7%; bottom: 10%; }

.app {
  max-width: 1150px;
  margin: 0 auto;
  background: var(--card);
  backdrop-filter: blur(9px);
  -webkit-backdrop-filter: blur(9px);
  border: 1px solid rgba(255,255,255,.55);
  border-radius: 18px;
  box-shadow: 0 14px 40px rgba(16,45,66,.15);
  padding: 1rem;
}
.app-header {
  display: flex;
  justify-content: space-between;
  gap: 1rem;
  align-items: flex-start;
}
.app-header h1 { margin: 0; font-size: clamp(1.55rem, 3vw, 2.25rem); }
.app-header h1 span { font-size: .78em; }
.app-header p { margin: .35rem 0 0; color: var(--muted); font-size: 1.08rem; }
.sound-toggle { font-weight: 700; display: flex; gap: .45rem; align-items: center; font-size: 1.02rem; }
.sound-toggle input { width: 1.1rem; height: 1.1rem; }

.progress-wrap { margin: .95rem 0; }
.progress-bar { height: 14px; background: #d6e5f2; border-radius: 999px; overflow: hidden; }
.progress-fill { height: 100%; width: 25%; background: linear-gradient(90deg, #0f6393, #18a2c5); transition: width .2s; }
.progress-steps {
  list-style: none; margin: .45rem 0 0; padding: 0;
  display: grid; grid-template-columns: repeat(4,1fr); gap: .5rem;
}
.progress-steps li {
  padding: .5rem; border-radius: 9px; text-align: center; font-weight: 700;
  background: rgba(234,245,255,.88); border: 1px solid #bfd9ea; font-size: .9rem;
}
.progress-steps li.active { background: #d9efff; border-color: #7cb8da; }
.progress-steps li.done { background: #d9f1df; border-color: #8dc79f; }

.panel { border: 1px solid #d6e7f3; border-radius: 14px; padding: 1rem; background: rgba(255,255,255,.8); }
.hidden { display: none; }
.challenge-card { background: rgba(242,249,255,.9); border: 1px solid #cee2f0; border-radius: 10px; padding: .8rem; }
.selection-text { font-weight: 800; }
.trait-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(245px, 1fr)); gap: .72rem; }
.trait-btn {
  border: 2px solid #c7dae8; border-radius: 12px; background: #fff; text-align: left;
  padding: .88rem; min-height: 115px; font-size: 1rem; cursor: pointer;
}
.trait-btn strong { display: block; margin-bottom: .35rem; font-size: 1.03rem; }
.trait-btn.selected { border-color: #1478ac; background: #e5f4fd; }

.button-row { display: flex; flex-wrap: wrap; gap: .7rem; margin-top: .85rem; }
.btn {
  border: none; border-radius: 10px; padding: .8rem 1rem; min-height: 48px; min-width: 150px;
  font-size: 1rem; font-weight: 700; cursor: pointer; background: #dce7f0; color: #173548;
}
.btn-primary { background: #0b74ad; color: #fff; }
.btn:disabled { opacity: .55; cursor: not-allowed; }

.trait-btn:focus-visible, .btn:focus-visible, .emoji-btn:focus-visible, textarea:focus-visible, input:focus-visible {
  outline: 3px solid var(--focus);
  outline-offset: 2px;
}

.badge { font-size: 1.25rem; font-weight: 900; }
.badge.high { color: #14753f; }
.badge.medium { color: #8c5f00; }
.badge.low { color: #93223f; }
.bullets li { margin: .32rem 0; line-height: 1.4; }
.tradeoff { background: #fff2dc; border-left: 4px solid #e5a033; padding: .62rem; border-radius: 6px; }

.match-card {
  margin-top: .65rem; border: 2px solid transparent; border-radius: 14px; padding: .85rem;
  display: grid; grid-template-columns: auto 84px 1fr; gap: .8rem; align-items: center;
  background: linear-gradient(#ffffffcc, #ffffffcc) padding-box, linear-gradient(120deg,#7bb8f0,#bfd8ff) border-box;
}
.match-card.theme-temperature { background: linear-gradient(#eef8ff,#eef8ff) padding-box, linear-gradient(120deg,#57a4ea,#9fd6ff) border-box; }
.match-card.theme-oxygen { background: linear-gradient(#eefcff,#eefcff) padding-box, linear-gradient(120deg,#3eb9b2,#7a79d8) border-box; }
.match-card.theme-predator { background: linear-gradient(#fff7ef,#fff7ef) padding-box, linear-gradient(120deg,#f79f44,#e45a44) border-box; }
.match-card.theme-competition { background: linear-gradient(#f4ffef,#f4ffef) padding-box, linear-gradient(120deg,#78b84a,#d8b23a) border-box; }
.match-badge {
  align-self: start; background: #102d42; color: #fff; border-radius: 999px;
  padding: .3rem .58rem; font-size: .78rem; font-weight: 900;
}
.match-thumb {
  width: 84px; height: 84px; border-radius: 10px; background: rgba(255,255,255,.78);
  display: grid; place-items: center; border: 1px solid rgba(16,45,66,.2);
}
.match-name { font-weight: 800; margin-bottom: .35rem; }
.fun-fact { font-size: .93rem; font-style: italic; color: #22445a; margin-top: .35rem; }

table { width: 100%; border-collapse: collapse; margin-bottom: .8rem; background: #fff; }
th, td { border: 1px solid #d0e2ef; padding: .58rem; text-align: left; }
th { background: #eaf5fd; }
#creatureCanvas {
  width: 100%;
  max-width: 960px;
  display: block;
  border: 1px solid #cadfed;
  border-radius: 9px;
  background: #f7fcff;
}
textarea {
  width: 100%; border: 1px solid #bfd5e5; border-radius: 8px; padding: .7rem; font-size: .96rem;
}
.emoji-row { display: flex; gap: .5rem; flex-wrap: wrap; }
.emoji-btn {
  border: 2px solid #c7dbe8; border-radius: 10px; font-size: 1.85rem;
  padding: .3rem .55rem; cursor: pointer; background: #fff;
}
.emoji-btn.selected { background: #dff0fc; border-color: #1375ad; }
.thanks { font-weight: 800; color: #156f3c; margin: .5rem 0 .2rem; }
.saved-local, .contact-line { font-size: .92rem; color: #2f5168; }

@media (max-width: 800px) {
  .app-header { flex-direction: column; }
  .progress-steps { grid-template-columns: 1fr 1fr; }
  .trait-grid { grid-template-columns: 1fr; }
  .match-card { grid-template-columns: 1fr; }
}
